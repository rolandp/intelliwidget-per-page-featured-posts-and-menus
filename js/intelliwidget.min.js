/*!
 * intelliwidget.js - Javascript for the Admin.
 *
 * @package IntelliWidget
 * @subpackage js
 * @author Lilaea Media
 * @copyright 2013
 * @access public
 *
 */
;jQuery(document).ready(function(e){IWAjax.openPanels=[];var b=function(){IWAjax.viewWidth=0;IWAjax.visWidth=0;IWAjax.leftTabs=[];IWAjax.rightTabs=[];IWAjax.visTabs=[];e(".iw-tab").each(function(){IWAjax.visTabs.push(e(this).prop("id"));IWAjax.visWidth+=e(this).outerWidth();e(this).show()});i()},n=function(){while(IWAjax.openPanels.length){el=IWAjax.openPanels.shift();e("#"+el).toggleClass("closed").show()}},i=function(){IWAjax.viewWidth=e("#iw_tabs").width()-24;if(IWAjax.viewWidth>0){count=0;while(IWAjax.visTabs.length&&IWAjax.visWidth>IWAjax.viewWidth){var q=IWAjax.visTabs.shift(),p=e("#"+q).outerWidth();IWAjax.visWidth-=p;e("#"+q).hide();IWAjax.leftTabs.push(q);if(++count>50){break}}}j()},m=function(){var p;if(p=IWAjax.visTabs.pop()){IWAjax.visWidth-=e("#"+p).outerWidth();e("#"+p).hide();IWAjax.rightTabs.unshift(p)}if(p=IWAjax.leftTabs.pop()){IWAjax.visWidth+=e("#"+p).outerWidth();e("#"+p).show();IWAjax.visTabs.unshift(p)}j()},h=function(){var p;if(p=IWAjax.visTabs.shift()){IWAjax.visWidth-=e("#"+p).outerWidth();e("#"+p).hide();IWAjax.leftTabs.push(p)}if(p=IWAjax.rightTabs.shift()){IWAjax.visWidth+=e("#"+p).outerWidth();e("#"+p).show();IWAjax.visTabs.push(p)}j()},j=function(){e("#iw_larr, #iw_rarr").css("visibility","hidden");if(IWAjax.rightTabs.length){e("#iw_rarr").css("visibility","visible")}if(IWAjax.leftTabs.length){e("#iw_larr").css("visibility","visible")}},g=function(p){e(p).find(".postbox h3, .postbox, .handlediv").on("click",function(r){var q=e(this).parent(".postbox"),s=q.attr("id");q.toggleClass("closed");if(s){if(!q.hasClass("closed")&&e.isFunction(postboxes.pbshow)){postboxes.pbshow(s)}else{if(q.hasClass("closed")&&e.isFunction(postboxes.pbhide)){postboxes.pbhide(s)}}}})},f=function(){e(this).prop("disabled",true);e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");e("body").off("click","#iw_cdfsave",f);e("#intelliwidget_cpt_spinner").show();var p={};e("input[name=post_ID],input[name=iwpage],.intelliwidget-input").each(function(q,r){fieldID=e(this).attr("id");p[fieldID]=e(this).val()});p.action="iw_cdfsave";e.post(IWAjax.ajaxurl,p,function(q){e("#iw_cdfsave").prop("disabled",false);e("#intelliwidget_cpt_spinner").hide();e(".iw-cdf-container").addClass("success");return false}).fail(function(){e("#iw_cdfsave").prop("disabled",false);e("#intelliwidget_cpt_spinner").hide();e(".iw-cdf-container").addClass("failure");return false});return false},c=function(){e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var v=e(this).prop("id"),t=e(this).parents(".iw-tabbed-section").first(),u=e(t).find(".iw-save-container"),s=e(t).find(".iw-save"),r="intelliwidget_"+v.split("_")[1],p={},q=[];t.find(".postbox").not(".closed").each(function(){IWAjax.openPanels.push(e(this).prop("id"))});e(s).prop("disabled",true);e("#"+r+"_spinner").show();e("body").off("click",s,c);p[r+"_post_types"]=[];e("input[name=post_ID],input[name=iwpage],input[type=text][id^="+r+"],input[type=checkbox][id^="+r+"]:checked,select[id^="+r+"],textarea[id^="+r+"],input[type=hidden][id^="+r+"]").each(function(w,x){fieldID=e(this).attr("id");if(fieldID.indexOf("_post_types")>0){p[r+"_post_types"].push(e(this).val())}else{p[fieldID]=e(this).val()}});p.action="iw_save";e.post(IWAjax.ajaxurl,p,function(w){if("fail"==w){e(u).addClass("failure")}else{var y=e(w.tab),x=e("#iw_tabs").find("#"+y.prop("id"));x.html(y.html());t.html(w.form);g(t);e("#iw_tabbed_sections").tabs("refresh").tabs({active:x.index()});e(t).find(".iw-save-container").addClass("success")}e(s).prop("disabled",false);e("#"+r+"_spinner").hide();return false},"json").fail(function(){e(s).prop("disabled",false);e("#"+r+"_spinner").hide();e(u).addClass("failure");return false});return false},a=function(){e(this).prop("disabled",true);e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");e("body").off("click","#iw_copy",a);e("#intelliwidget_spinner").show();var p={};e("input[name=post_ID],input[name=iwpage],select[id=intelliwidget_widget_page_id]").each(function(q,r){fieldID=e(this).attr("id");p[fieldID]=e(this).val()});p.action="iw_copy";e.post(IWAjax.ajaxurl,p,function(q){e("#iw_copy").prop("disabled",false);e("#intelliwidget_spinner").hide();e(".iw-copy-container").addClass("success");return false}).fail(function(){e("#iw_copy").prop("disabled",false);e("#intelliwidget_spinner").hide();e(".iw-copy-container").addClass("failure");return false});return false},l=function(s){s.preventDefault();s.stopPropagation();if(e(this).hasClass("disabled")){return false}e(this).addClass("disabled");e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var t=e(this).attr("id"),r="#"+t,q=e(this).attr("href"),p=d(q);e("#intelliwidget_spinner").show();p.action="iw_add";e.post(IWAjax.ajaxurl,p,function(u){e(r).removeClass("disabled");e("#intelliwidget_spinner").hide();if("fail"==u){e(".iw-copy-container").addClass("failure")}else{form=e(u.form).hide();tab=e(u.tab).hide();e("#iw_tabbed_sections").append(form);g(form);e("#iw_tabs").append(tab);tab.show();e("#iw_tabbed_sections").tabs("refresh").tabs({active:tab.index()});b();e(".iw-copy-container").addClass("success")}return false},"json").fail(function(){e(r).removeClass("disabled");e("#intelliwidget_spinner").hide();e(".iw-copy-container").addClass("failure");return false});return false},k=function(t){t.preventDefault();t.stopPropagation();if(e(this).hasClass("disabled")){return false}e(this).addClass("disabled");e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var u=e(this).attr("id"),r="#"+u,q=e(this).attr("href"),p=d(q),s=p.iwdelete;e("#intelliwidget_"+s+"_spinner").show();p.action="iw_delete";e.post(IWAjax.ajaxurl,p,function(v){e(r).removeClass("disabled");e("#intelliwidget_"+s+"_spinner").hide();if("success"==v){var x=e("#iw_tabbed_section_"+s),w=x.index();x.remove();e("#iw_tab_"+s).remove();e("#iw_tabbed_sections").tabs("refresh");b();w-=IWAjax.leftTabs.length;e("#iw_tabbed_sections").tabs({active:w})}return false}).fail(function(){e(r).removeClass("disabled");e("#intelliwidget_"+s+"_spinner").hide();return false});return false},d=function(p){var t,q,r={},s=p.substring(p.indexOf("?")+1).split("&");for(q=0;q<s.length;q++){t=s[q].split("=");r[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return r},o=function(y,x){var v,q="#"+y+"_div",w=(!x&&!e("#"+y).val()),p=e("#"+y+"_aa").val(),t=("00"+e("#"+y+"_mm").val()).slice(-2),u=("00"+e("#"+y+"_jj").val()).slice(-2),s=("00"+e("#"+y+"_hh").val()).slice(-2),r=("00"+e("#"+y+"_mn").val()).slice(-2),z=e("#"+y+"_og").val();if(!e(q).length){return true}v=new Date(p,t-1,u,s,r);if(v.getFullYear()!=p||(1+v.getMonth())!=t||v.getDate()!=u||v.getMinutes()!=r){if(true==x&&!z){e(q).addClass("form-invalid");e(".iw-cdfsave").attr("disabled","disabled");return false}w=true}e(q).removeClass("form-invalid");e(".iw-cdfsave").removeAttr("disabled");if(w){if(!z){e("#"+y+"_timestamp").html("")}e("#"+y).val("")}else{if("intelliwidget_expire_date"==y){e("#intelliwidget_ongoing").val(e("#"+y+"_og").is(":checked")?1:0);if(e("#"+y+"_og").is(":checked")){e("#"+y+"_timestamp").html(e("#intelliwidget_ongoing_label").text());e("#"+y).val("");return true}}e("#"+y+"_timestamp").html("<b>"+e('option[value="'+e("#"+y+"_mm").val()+'"]',"#"+y+"_mm").text()+" "+u+", "+p+" @ "+s+":"+r+"</b> ");e("#"+y).val(p+"-"+e("#"+y+"_mm").val()+"-"+u+" "+s+":"+r)}return true};e(document).ajaxComplete(n);e("#iw_tabbed_sections").tabs();e("body").on("click",".iw-collapsible",function(){id=e(this).attr("id");sel="#"+id+"-inside";e(sel).toggleClass("closed").stop().slideToggle()});e("body").on("click",".iw-save",c);e("body").on("click",".iw-cdfsave",f);e("body").on("click",".iw-copy",a);e("body").on("click",".iw-add",l);e("body").on("click",".iw-delete",k);e("body").on("change",".iw-control",c);e("body").on("change",".iw-widget-control",function(p){var q=e(this).parents("div.widget").first();q.find(".iw-section-inside").not(".closed").each(function(){IWAjax.openPanels.push(e(this).prop("id"))});wpWidgets.save(q,0,0,0)});o("intelliwidget_event_date",false);o("intelliwidget_expire_date",false);e("body").on("click","a.intelliwidget-edit-timestamp",function(){var p=e(this).attr("id").split("-",1);if(e("#"+p+"_div").is(":hidden")){e("#"+p+"_div").slideDown("fast");e("#"+p+"_mm").focus();e(this).hide()}return false});e("body").on("click",".intelliwidget-clear-timestamp",function(){var p=e(this).attr("id").split("-",1);e("#"+p+"_div").slideUp("fast");e("#"+p+"_mm").val(e("#"+p+"_cur_mm").val());e("#"+p+"_jj").val(e("#"+p+"_cur_jj").val());e("#"+p+"_aa").val(e("#"+p+"_cur_aa").val());e("#"+p+"_hh").val(e("#"+p+"_cur_hh").val());e("#"+p+"_mn").val(e("#"+p+"_cur_mn").val());e("#"+p+"_og").prop("checked",false);e("#"+p+"_timestamp").html("");e("#"+p).val("");e("a#"+p+"-edit").show();o(p,false);return false});e("body").on("click",".intelliwidget-cancel-timestamp",function(){var p=e(this).attr("id").split("-",1);e("#"+p+"_div").slideUp("fast");e("#"+p+"_mm").val(e("#"+p+"_hidden_mm").val());e("#"+p+"_jj").val(e("#"+p+"_hidden_jj").val());e("#"+p+"_aa").val(e("#"+p+"_hidden_aa").val());e("#"+p+"_hh").val(e("#"+p+"_hidden_hh").val());e("#"+p+"_mn").val(e("#"+p+"_hidden_mn").val());e("#"+p+"_og").prop("checked",e("#"+p+"_hidden_og").val()?true:false);e("a#"+p+"-edit").show();o(p,false);return false});e("body").on("click",".intelliwidget-save-timestamp",function(){var p=e(this).attr("id").split("-",1);if(o(p,true)){e("#"+p+"_div").slideUp("fast");e("a#"+p+"-edit").show()}return false});e("#iw_tabbed_sections").on("click","#iw_larr, #iw_rarr",function(p){p.preventDefault();p.stopPropagation();if(e(this).is(":visible")){if("iw_larr"==e(this).prop("id")){m()}else{h()}}});e(window).resize(i);e("#iw_tabbed_sections").slideDown();b()});