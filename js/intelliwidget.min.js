/*!
 * intelliwidget.js - Javascript for the Admin.
 *
 * @package IntelliWidget
 * @subpackage js
 * @author Lilaea Media
 * @copyright 2013
 * @access public
 *
 */
;jQuery(document).ready(function(e){IWAjax.openPanels={};var o=function(s){s.find(".inside").each(function(){var t=e(this).prop("id");IWAjax.openPanels[t]=e(this).parent(".postbox").hasClass("closed")?0:1})},d=function(t,s,v){if(!s.responseText.match(/intelliwidget/)){return}for(var u in IWAjax.openPanels){if(IWAjax.openPanels.hasOwnProperty(u)&&IWAjax.openPanels[u]==1){e("#"+u).parent(".postbox").removeClass("closed");e("#"+u).show()}}},r=function(){IWAjax.viewWidth=0;IWAjax.visWidth=0;IWAjax.leftTabs=[];IWAjax.rightTabs=[];IWAjax.visTabs=[];e(".iw-tab").each(function(){IWAjax.visTabs.push(e(this).prop("id"));IWAjax.visWidth+=e(this).outerWidth();e(this).show()});q()},q=function(){IWAjax.viewWidth=e("#iw_tabs").width()-24;if(IWAjax.viewWidth>0){count=0;while(IWAjax.visTabs.length&&IWAjax.visWidth>IWAjax.viewWidth){var t=IWAjax.visTabs.shift(),s=e("#"+t).outerWidth();IWAjax.visWidth-=s;e("#"+t).hide();IWAjax.leftTabs.push(t);if(++count>50){break}}}f()},n=function(){var s;if(s=IWAjax.visTabs.pop()){IWAjax.visWidth-=e("#"+s).outerWidth();e("#"+s).hide();IWAjax.rightTabs.unshift(s)}if(s=IWAjax.leftTabs.pop()){IWAjax.visWidth+=e("#"+s).outerWidth();e("#"+s).show();IWAjax.visTabs.unshift(s)}f()},g=function(){var s;if(s=IWAjax.visTabs.shift()){IWAjax.visWidth-=e("#"+s).outerWidth();e("#"+s).hide();IWAjax.leftTabs.push(s)}if(s=IWAjax.rightTabs.shift()){IWAjax.visWidth+=e("#"+s).outerWidth();e("#"+s).show();IWAjax.visTabs.push(s)}f()},f=function(){e("#iw_larr, #iw_rarr").css("visibility","hidden");if(IWAjax.rightTabs.length){e("#iw_rarr").css("visibility","visible")}if(IWAjax.leftTabs.length){e("#iw_larr").css("visibility","visible")}},m=function(s){e(s).find(".postbox h3, .handlediv").on("click",function(u){var t=e(this).parent(".postbox"),v=t.attr("id");t.toggleClass("closed");if(v){if(!t.hasClass("closed")&&e.isFunction(postboxes.pbshow)){postboxes.pbshow(v)}else{if(t.hasClass("closed")&&e.isFunction(postboxes.pbhide)){postboxes.pbhide(v)}}}})},j=function(){e(this).prop("disabled",true);e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");e("body").off("click","#iw_cdfsave",j);e("#intelliwidget_cpt_spinner").show();var s={};e("input[name=post_ID],input[name=iwpage],.intelliwidget-input").each(function(t,u){fieldID=e(this).attr("id");s[fieldID]=e(this).val()});s.action="iw_cdfsave";e.post(IWAjax.ajaxurl,s,function(t){e("#iw_cdfsave").prop("disabled",false);e("#intelliwidget_cpt_spinner").hide();e(".iw-cdf-container").addClass("success");return false}).fail(function(){e("#iw_cdfsave").prop("disabled",false);e("#intelliwidget_cpt_spinner").hide();e(".iw-cdf-container").addClass("failure");return false});return false},k=function(){e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var x=e(this).prop("id"),v=e(this).parents(".iw-tabbed-section").first(),w=e(v).find(".iw-save-container"),u=e(v).find(".iw-save"),t="intelliwidget_"+x.split("_")[1],s={};e(u).prop("disabled",true);o(v);e("."+t+"_spinner").show();e("body").off("click",u,k);s[t+"_post_types"]=[];e("input[name=post_ID],input[name=iwpage],input[type=text][id^="+t+"],input[type=checkbox][id^="+t+"]:checked,select[id^="+t+"],textarea[id^="+t+"],input[type=hidden][id^="+t+"]").each(function(y,z){fieldID=e(this).attr("id");if(fieldID.indexOf("_post_types")>0){s[t+"_post_types"].push(e(this).val())}else{s[fieldID]=e(this).val()}});s.action="iw_save";e.post(IWAjax.ajaxurl,s,function(y){if("fail"==y){e(w).addClass("failure")}else{var A=e(y.tab),z=e("#iw_tabs").find("#"+A.prop("id"));z.html(A.html());v.html(y.form);m(v);e("#iw_tabbed_sections").tabs("refresh").tabs({active:z.index()});e(v).find(".iw-save-container").addClass("success")}e(u).prop("disabled",false);e("."+t+"_spinner").hide();return false},"json").fail(function(){e(u).prop("disabled",false);e("."+t+"_spinner").hide();e(w).addClass("failure");return false});return false},b=function(){e(this).prop("disabled",true);e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");e("body").off("click","#iw_copy",b);e("#intelliwidget_spinner").show();var s={};e("input[name=post_ID],input[name=iwpage],select[id=intelliwidget_widget_page_id]").each(function(t,u){fieldID=e(this).attr("id");s[fieldID]=e(this).val()});s.action="iw_copy";e.post(IWAjax.ajaxurl,s,function(t){e("#iw_copy").prop("disabled",false);e("#intelliwidget_spinner").hide();e(".iw-copy-container").addClass("success");return false}).fail(function(){e("#iw_copy").prop("disabled",false);e("#intelliwidget_spinner").hide();e(".iw-copy-container").addClass("failure");return false});return false},l=function(v){v.preventDefault();v.stopPropagation();if(e(this).hasClass("disabled")){return false}e(this).addClass("disabled",true);e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var w=e(this).attr("id"),u="#"+w,t=e(this).attr("href"),s=h(t);e("#intelliwidget_spinner").show();s.action="iw_add";e.post(IWAjax.ajaxurl,s,function(x){e(u).removeClass("disabled");e("#intelliwidget_spinner").hide();if("fail"==x){e(".iw-copy-container").addClass("failure")}else{form=e(x.form).hide();tab=e(x.tab).hide();e("#iw_tabbed_sections").append(form);m(form);e("#iw_tabs").append(tab);tab.show();e("#iw_tabbed_sections").tabs("refresh").tabs({active:tab.index()});r();e(".iw-copy-container").addClass("success")}return false},"json").fail(function(){e(u).removeClass("disabled");e("#intelliwidget_spinner").hide();e(".iw-copy-container").addClass("failure");return false});return false},p=function(w){w.preventDefault();w.stopPropagation();if(e(this).hasClass("disabled")){return false}e(this).addClass("disabled");e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var x=e(this).attr("id"),u="#"+x,t=e(this).attr("href"),s=h(t),v=s.iwdelete;e("#intelliwidget_"+v+"_spinner").show();s.action="iw_delete";e.post(IWAjax.ajaxurl,s,function(y){e(u).removeClass("disabled");e("#intelliwidget_"+v+"_spinner").hide();if("success"==y){var A=e("#iw_tabbed_section_"+v),z=A.index();A.remove();e("#iw_tab_"+v).remove();e("#iw_tabbed_sections").tabs("refresh");r();z-=IWAjax.leftTabs.length;e("#iw_tabbed_sections").tabs({active:z})}return false}).fail(function(){e(u).removeClass("disabled");e("#intelliwidget_"+v+"_spinner").hide();return false});return false},c=function(){e(".iw-copy-container,.iw-save-container,.iw-cdf-container").removeClass("success failure");var w=e(this).parents(".iw-tabbed-section").first(),y=w.prop("id"),v="intelliwidget_"+y.split("_").pop(),t=w.find("#"+v+"_menus"),x=e(w).find(".iw-save-container"),u=e(w).find(".iw-save"),s={};if(t.has("select").length){return false}e(u).prop("disabled",true);e("."+v+"_spinner").show();e("input[name=post_ID],input[name=iwpage],input[type=hidden][id^="+v+"]").each(function(z,A){fieldID=e(this).attr("id");s[fieldID]=e(this).val()});s.action="iw_get";e.post(IWAjax.ajaxurl,s,function(z){if("fail"==z){e(x).addClass("failure")}else{t.html(z);e(w).find(".iw-save-container").addClass("success")}e(u).prop("disabled",false);e("."+v+"_spinner").hide();return false}).fail(function(){e(u).prop("disabled",false);e("."+v+"_spinner").hide();e(x).addClass("failure");return false});return false},a=function(){var w=e(this).parents(".widget").first(),x=w.find(".widget-id").val(),t=e("#_wpnonce_widgets").val(),v="widget-"+x,u=w.find("#"+v+"-menus"),s={};if(u.has("select").length){return false}s["widget-id"]=x;s._wpnonce_widgets=t;s.action="iw_widget_get";e.post(IWAjax.ajaxurl,s,function(y){if("fail"==y){}else{u.html(y)}return false}).fail(function(){return false});return false},h=function(s){var w,t,u={},v=s.substring(s.indexOf("?")+1).split("&");for(t=0;t<v.length;t++){w=v[t].split("=");u[decodeURIComponent(w[0])]=decodeURIComponent(w[1])}return u},i=function(B,A){var y,t="#"+B+"_div",z=(!A&&!e("#"+B).val()),s=e("#"+B+"_aa").val(),w=("00"+e("#"+B+"_mm").val()).slice(-2),x=("00"+e("#"+B+"_jj").val()).slice(-2),v=("00"+e("#"+B+"_hh").val()).slice(-2),u=("00"+e("#"+B+"_mn").val()).slice(-2),C=e("#"+B+"_og").val();if(!e(t).length){return true}y=new Date(s,w-1,x,v,u);if(y.getFullYear()!=s||(1+y.getMonth())!=w||y.getDate()!=x||y.getMinutes()!=u){if(true==A&&!C){e(t).addClass("form-invalid");e(".iw-cdfsave").prop("disabled",true);return false}z=true}e(t).removeClass("form-invalid");e(".iw-cdfsave").prop("disabled",false);if(z){if(!C){e("#"+B+"_timestamp").html("")}e("#"+B).val("")}else{if("intelliwidget_expire_date"==B){e("#intelliwidget_ongoing").val(e("#"+B+"_og").is(":checked")?1:0);if(e("#"+B+"_og").is(":checked")){e("#"+B+"_timestamp").html(e("#intelliwidget_ongoing_label").text());e("#"+B).val("");return true}}e("#"+B+"_timestamp").html("<b>"+e('option[value="'+e("#"+B+"_mm").val()+'"]',"#"+B+"_mm").text()+" "+x+", "+s+" @ "+v+":"+u+"</b> ");e("#"+B).val(s+"-"+e("#"+B+"_mm").val()+"-"+x+" "+v+":"+u)}return true};e(document).ajaxComplete(d);e("#iw_tabbed_sections").tabs();e("body").on("click",".iw-collapsible > .handlediv, .iw-collapsible > h4",function(t){t.stopPropagation();var s=e(this).parent(".postbox"),u=e(this).parents("div.widget").first();s.toggleClass("closed");o(u)});e("body").on("click","#iw_tabbed_sections .panel-selection h3, #iw_tabbed_sections .panel-selection .handlediv",c);e("body").on("click",".widget-inside .panel-selection h4, .widget-inside .panel-selection .handlediv",a);e("body").on("click",".iw-save",k);e("body").on("click",".iw-cdfsave",j);e("body").on("click",".iw-copy",b);e("body").on("click",".iw-add",l);e("body").on("click",".iw-delete",p);e("body").on("change",".iw-control",k);e("body").on("change",".iw-widget-control",function(s){var t=e(this).parents("div.widget").first();o(t);wpWidgets.save(t,0,0,0)});i("intelliwidget_event_date",false);i("intelliwidget_expire_date",false);e("body").on("click","a.intelliwidget-edit-timestamp",function(){var s=e(this).attr("id").split("-",1);if(e("#"+s+"_div").is(":hidden")){e("#"+s+"_div").slideDown("fast");e("#"+s+"_mm").focus();e(this).hide()}return false});e("body").on("click",".intelliwidget-clear-timestamp",function(){var s=e(this).attr("id").split("-",1);e("#"+s+"_div").slideUp("fast");e("#"+s+"_mm").val(e("#"+s+"_cur_mm").val());e("#"+s+"_jj").val(e("#"+s+"_cur_jj").val());e("#"+s+"_aa").val(e("#"+s+"_cur_aa").val());e("#"+s+"_hh").val(e("#"+s+"_cur_hh").val());e("#"+s+"_mn").val(e("#"+s+"_cur_mn").val());e("#"+s+"_og").prop("checked",false);e("#"+s+"_timestamp").html("");e("#"+s).val("");e("a#"+s+"-edit").show();i(s,false);return false});e("body").on("click",".intelliwidget-cancel-timestamp",function(){var s=e(this).attr("id").split("-",1);e("#"+s+"_div").slideUp("fast");e("#"+s+"_mm").val(e("#"+s+"_hidden_mm").val());e("#"+s+"_jj").val(e("#"+s+"_hidden_jj").val());e("#"+s+"_aa").val(e("#"+s+"_hidden_aa").val());e("#"+s+"_hh").val(e("#"+s+"_hidden_hh").val());e("#"+s+"_mn").val(e("#"+s+"_hidden_mn").val());e("#"+s+"_og").prop("checked",e("#"+s+"_hidden_og").val()?true:false);e("a#"+s+"-edit").show();i(s,false);return false});e("body").on("click",".intelliwidget-save-timestamp",function(){var s=e(this).attr("id").split("-",1);if(i(s,true)){e("#"+s+"_div").slideUp("fast");e("a#"+s+"-edit").show()}return false});e("#iw_tabbed_sections").on("click","#iw_larr, #iw_rarr",function(s){s.preventDefault();s.stopPropagation();if(e(this).is(":visible")){if("iw_larr"==e(this).prop("id")){n()}else{g()}}});e(window).resize(q);e("#iw_tabbed_sections").slideDown();r()});